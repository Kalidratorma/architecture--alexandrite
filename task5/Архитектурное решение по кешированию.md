
# Архитектурное решение по кешированию

## 1. Анализ системы

Анализ показал, что основными проблемными зонами являются:

- Долгая загрузка главной страницы MES (список заказов в работе).
- Задержки при обновлении статуса заказа, особенно при высокой нагрузке.

## 2. Мотивация

Внедрение кеширования должно:

- Ускорить загрузку страниц, особенно в MES.
- Снизить нагрузку на базу данных.
- Повысить отзывчивость интерфейса операторов и удовлетворённость клиентов.

Элементы системы для кеширования:

- Список заказов (по статусу)
- Статусы заказов по ID
- 3D-модель изделия (в случае повторного доступа)

## 3. Предлагаемое решение

### Тип кеширования: серверное

Кеш должен быть реализован на уровне серверов MES и CRM, так как это позволит централизованно управлять данными и уменьшить нагрузку на базу.

### Выбранный паттерн: **Cache-Aside**

**Почему Cache-Aside:**
- Хорошо работает с редко изменяющимися данными (например, список заказов).
- Прост в реализации.
- Позволяет не хранить "грязные" или устаревшие данные.

**Почему не Write-Through:**
- Требует синхронной записи в кеш и БД, что замедляет операции.

**Почему не Refresh-Ahead:**
- Сложнее реализовать предиктивную актуализацию, а прирост производительности минимален для данного кейса.

## 4. Диаграмма последовательности

*Чтение списка заказов (cache hit & miss), обновление статуса заказа* см. [Диаграмма последовательности](sequence_diagram.png).

## 5. Стратегия инвалидации кеша

### Выбранная стратегия: **по ключу + временная**

- При обновлении статуса заказа происходит инвалидация по ключу.
- Дополнительно используется TTL для автоматического удаления устаревших данных.

**Почему не только временная:** возможны частые обновления данных, и TTL может устаревать раньше времени.

**Почему не только по ключу:** не все обновления могут быть явно отловлены, TTL позволяет дополнительно защититься от устаревания данных.

## 6. Сравнительная таблица стратегий

| Стратегия         | Подходит | Особенности | Не подходит, если |
|-------------------|----------|-------------|--------------------|
| По ключу          | Да       | Простая, точная | Пропущено событие обновления |
| Временная (TTL)   | Да       | Удаление через заданное время | Быстро устаревают данные |
| Программная       | Возможно | Гибкость | Требует сложной логики |

## 7. Дополнительное задание

### Сравнение технологий

| Критерий     | Redis         | Memcached     |
|--------------|---------------|---------------|
| TTL          | Есть          | Есть          |
| Структуры    | Множество типов | Только строки |
| Поддержка репликации | Есть | Нет            |
| Прочность     | Есть (RDB, AOF) | Нет          |
| Расход памяти | Выше (за счёт типов) | Ниже        |

**Выбор:** Redis — за счёт богатства функциональности и поддержки различных структур данных.
