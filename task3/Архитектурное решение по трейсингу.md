
# Архитектурное решение по трейсингу

## 1. Анализ текущей ситуации
Заказы часто зависают или теряются, и определить текущий статус или место, где возникла проблема, затруднительно.

## 2. Места, которые следует покрыть трейсингом
На основе анализа текущей архитектуры следует покрыть трейсингом:

- Онлайн-магазин (Java Spring Boot)
- MES (C#)
- CRM (Java Spring Boot)
- Очереди сообщений RabbitMQ

## 3. Данные, которые должны попадать в трейсинг
- Идентификатор заказа (Order ID)
- Идентификатор клиента (Customer ID)
- Временные метки каждого изменения статуса
- Статус заказа
- Сообщения и события в RabbitMQ

## 4. Мотивация
Внедрение трейсинга позволит компании:

- Быстро выявлять и устранять проблемы с зависаниями и потерей заказов.
- Повысить прозрачность процессов и улучшить качество поддержки клиентов.
- Снизить затраты на поддержку за счёт сокращения времени на диагностику.

### Технические и бизнес-метрики:
- Среднее время решения проблемы с заказом
- Количество зависших заказов
- Количество потерянных заказов
- Количество обращений клиентов по статусу заказа
- Общая удовлетворённость клиентов (по отзывам и NPS)

## 5. Предлагаемое решение
### Технологии и компоненты:
- **OpenTelemetry** для сбора и передачи трейсинговых данных.
- **Jaeger** для хранения и визуализации трейсов.

### Реализация:
- Внедрить SDK OpenTelemetry в приложения онлайн-магазина, MES и CRM.
- Внедрить трейсинг сообщений RabbitMQ с помощью интеграций OpenTelemetry.
- Развернуть Jaeger в инфраструктуре компании.
- Настроить передачу трейсов в хранилище трейсинга.

[Диаграмма с новыми компонентами и связями](diagram.drawio) (новые компоненты выделены красным).

## 6. Компромиссы
Трейсинг может быть неэффективен или сложен для реализации в случае:

- Работа с проприетарным ПО, которое не поддерживает стандарты OpenTelemetry.
- Высокие накладные расходы на внедрение в устаревшие сервисы, где нет поддержки SDK.

## 7. Безопасность
- Доступ к трейсинг-системе будет реализован через корпоративный SSO.
- Ограничение доступа по ролям. Только сотрудники команды поддержки и DevOps-инженеры смогут просматривать трейсы.

## 8. Дополнительное задание (Мониторинг и алертинг на основе трейсинга)
Автоматический мониторинг состояния заказов и алертинг:

- Реализовать автоматическое создание алертов, если заказ находится в одном статусе дольше допустимого времени.
- Использовать Alertmanager от Prometheus с интеграцией в Grafana и систему тикетов Jira.
- Новые элементы на диаграмме [отмечены зелёным](diagram.drawio).
